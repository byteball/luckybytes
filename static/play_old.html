<!DOCTYPE HTML>
<!--
	Stellar by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->



<html>
	<head>
		<title>Luckybytes - The provable fair Byteball Lottery</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<!--[if lte IE 8]><script src="assets/js/ie/html5shiv.js"></script><![endif]-->
		<link rel="stylesheet" href="assets/css/main.css" />
		<meta name="description" content="Luckybytes - The provable fair Byteball Lottery">
		<meta name="keywords" content="byteball, lottery, provable, fair, gamble, bytes, luckybytes" />
		<!--[if lte IE 9]><link rel="stylesheet" href="assets/css/ie9.css" /><![endif]-->
		<!--[if lte IE 8]><link rel="stylesheet" href="assets/css/ie8.css" /><![endif]-->
		<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
		
		<script async src="https://www.googletagmanager.com/gtag/js?id=UA-105573136-2"></script>
		<script>
		  window.dataLayer = window.dataLayer || [];
		  function gtag(){dataLayer.push(arguments)};
		  gtag('js', new Date());

		  gtag('config', 'UA-105573136-2');
		</script>
	</head>
	<body>

		<!-- Wrapper -->
			<div id="wrapper">

				  <!-- 
					<header id="header" class="alt">
					
						
						<h1><i class="icon fa-ticket"></i></h1>
						<h1>Luckybytes</h1>
						<p>The provable fair Byteball Lottery</p>
					</header>
 -->
				<!-- Nav -->
					<nav id="nav">
						<ul>
							<li><a href="#play" class="active">Play</a></li>
							<li><a href="#settings">Settings</a></li>
							<li><a href="#history">History</a></li>
						</ul>
						<div class="wrapper" style="display: flex;">
							<div class="block" style="width: 50%; text-align: center;">Account: <strong><span id="username">not logged in</span></strong></div><div class="block" style="width: 50%; text-align: center;">Tickets: <strong><span id="tickets">0</span></strong> <i class="icon fa-ticket"></i></div>
						</div>
					</nav>
 
					
				<!-- Main -->
					<div id="main">
						<!-- Introduction <ul class="features" style="text-align: left;"> --> 
						<section id="play" class="main">
							</br>
							<div id="noaccount" class="content">
								<h1>Not logged in!</h1></br>
								<h3>To play online you need to login through the luckybtes chat bot. With the command: <strong> online </strong>. Or click on <strong> play online </strong> in the menu.</h3>
								</br>
							</div>
							<div id="accountdata" class="spotlight" style="display: none;">
								<div class="content" style="text-align: left;">


									<ul class="actions">

										Join an active game:

										<ul class="statistics" style="width: 100%">
											<li class="style4 single">
												<strong>luckybaud <span id="game4">(...)</span></strong>Price: 40 MB &emsp; Slots: <span id="slots4">0</span>/4 &emsp; Your Tickets: <span id="own4">0</span>
												<a id="bjoin4" onclick="joingame('4')" class="button special fit">Join now!</a>
											</li>
										</ul>

										<ul class="statistics" style="width: 100%; margin-top: -1em;">
											<li class="style5 single">
												<strong>luckybyte <span id="game8">(...)</span></strong>Price: 80 MB &emsp; Slots: <span id="slots8">0</span>/8 &emsp; Your Tickets: <span id="own8">0</span>
												<a id="bjoin8" onclick="joingame('8')" class="button special fit">Join now!</a>
											</li>
										</ul>

										<ul class="statistics" style="width: 100%; margin-top: -1em;">
											<li class="style1 single">
												<strong>luckyint <span id="game32">(...)</span></strong>Price: 320 MB &emsp; Slots: <span id="slots32">0</span>/32 &emsp; Your Tickets: <span id="own32">0</span>
												<a id="bjoin32" onclick="joingame('32')" class="button special fit">Join now!</a>
											</li>
										</ul>

									</ul>
								</div>

								<!--<span class="image"><img src="images/pic01.jpg" alt="" /></span>-->
							</div>
						</section>
	
						<section id="settings" class="main" style="display: none;">
							<h2>Your Account settings</h2>
							
								<h3>Notifications:</h3> 

							<h4>
								Chat Messages:

								<label class="switch">
									<input type="checkbox" id="chatmessages" onchange="change_settings('chatmessages')">
									<span class="slider round"></span>
								</label>

							</h4> 

							<h4>
								Global Winning Notifications:

								<label class="switch">
									<input type="checkbox" id="notifications" onchange="change_settings('notifications')">
									<span class="slider round"></span>
								</label>

							</h4> 

								<h3>Auto join:</h3> 

							<h4>
								Luckybaud:
								<label class="switch" onclick="change_settings('auto4')">
									<input type="checkbox" id="auto4">
									<span class="slider round"></span>
								</label>
							</h4> 

							<h4>
								Luckybyte:
								<label class="switch" >
									<input type="checkbox" id="auto8" onchange="change_settings('auto8')">
									<span class="slider round"></span>
								</label>
							</h4> 

							<h4>
								Luckyint:
								<label class="switch">
									<input type="checkbox" id="auto32" onchange="change_settings('auto32')">
									<span class="slider round"></span>
								</label>
							</h4> 
							

						</section>
						<section id="history" class="main">
							<h3>Your Game History</h3>
							<div class="table-wrapper">
								<table class="alt">
									<thead>
										<tr>
											<th>Game</th>
											<th>Your Slots</th>
											<th>Proof</th>
										</tr>
									</thead>
									<tbody id="ownhistory">
										<tr>
											<td>Loading...</td>
											<td>Loading...</td>
											<td>Loading...</td>
										</tr>
									</tbody>
								</table>
							</div>

							<h3>Global Game History</h3>
							<div class="table-wrapper">
								<table class="alt">
									<thead>
										<tr>
											<th>Game</th>
											<th>Players</th>
											<th>Proof</th>
										</tr>
									</thead>
									<tbody id="gamehistory">
										<tr>
											<td>Loading...</td>
											<td>Loading...</td>
											<td>Loading...</td>
										</tr>
									</tbody>
								</table>
							</div>


						</section>
					</div>


			</div>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/jquery.scrollex.min.js"></script>
			<script src="assets/js/jquery.scrolly.min.js"></script>
			<script src="assets/js/skel.min.js"></script>
			<script src="assets/js/util.js"></script>
			<!--[if lte IE 8]><script src="assets/js/ie/respond.min.js"></script><![endif]-->
			<script src="assets/js/main.js"></script>
			


<div id="notification" style="display: none;"></div>

<script src="./superagent.js"></script>
<script>
	var account = '';
	var last_msg = '';

window.onload = function () {

	document.getElementById("accountdata").style.display = "none"; //none
	document.getElementById("settings").style.display = "none";

	if (getParams("account")) {
		account=getParams("account");
		notifyMe('Logging in with account: '+account);
		// try to gather information from this account
		getaccount();
		setInterval(function () {
			getaccount();
		}, 5000);
	} else {
		notifyMe('You need to login through the app in order to play online!',5000);
	}

	getgames();

	setInterval(function () {
		getgames();
	}, 1000);
}

	function gametable(data) {
		// Create Game History Table
		var tableBody = document.getElementById("gamehistory");
		tableBody.innerHTML = "";
		for (var i = 0; i < data.history.length; i++) {
			var gamename = '';
			var game = data.history[i].game;
			var type = data.history[i].type;
			var win = data.history[i].winning_slot;
			var proof = data.history[i].proof;
			var price = Number(type) * 10 + " MB";
			if (type === '4') { gamename = 'luckybaud'; }
			else if (type === '8') { gamename = 'luckybyte'; }
			else if (type === '32') { gamename = 'luckyint'; }
			gamename = gamename + '(' + game.slice(0, 4) + '...)';
			var players = [];
			for (var j = 0; j < data.history[i].slots.length; j++) {
				if (j === (win - 1)) {
					players.push(data.history[i].slots[j].name + ' (<i class="icon style6 fa-star"></i>)');
				} else {
					players.push(data.history[i].slots[j].name);
				}
			}
			tableBody.innerHTML += "<tr><td>" + gamename + "</td><td>" + players.join(', ') + "</td><td><a href='./proof.html?proofid="+proof+"'>" + proof.slice(0, 6) + '...' + "</a></td></tr>"
		}
		// Update active games
		for (var i = 0; i < data.active.length; i++) {
			var game = data.active[i].game;
			var type = data.active[i].type;
			var slots = data.active[i].slots;

			if (data.active[i].status==="time") {
				//document.getElementById("days").textContent = data.active[i].days;
				//document.getElementById("hours").textContent = data.active[i].hours;
				//document.getElementById("minutes").textContent = data.active[i].minutes;
				//document.getElementById("jackpottickets").textContent = data.active[i].prize;
				//document.getElementById("jackpot").textContent = slots.length;
			} else {
				document.getElementById("game" + type).textContent = '(' + game.slice(0, 4) + '...)';
				document.getElementById("slots" + type).textContent = slots.length;
			}

		}
		// Update own games
		if (data.own) {
			document.getElementById("own4").textContent = data.own.game4;
			document.getElementById("own8").textContent = data.own.game8;
			document.getElementById("own32").textContent = data.own.game32;
		}

		//Update own historical games
		if (data.ownhistory) {
			var tableBody = document.getElementById("ownhistory");
			tableBody.innerHTML = "";
			for (var i = 0; i < data.history.length; i++) {
				var gamename = '';
				var game = data.ownhistory[i].game;
				var type = data.ownhistory[i].type;
				var win = data.ownhistory[i].winning_slot;
				var proof = data.ownhistory[i].proof;
				var myslots = data.ownhistory[i].myslots;
				var price = data.ownhistory[i].price;


				if (type === '4') { gamename = 'luckybaud'; }
				else if (type === '8') { gamename = 'luckybyte'; }
				else if (type === '32') { gamename = 'luckyint'; }
				gamename = gamename + '(' + game.slice(0, 4) + '...)';
				if (price > 0) { gamename = gamename +' <i class="icon style6 fa-star"></i> ('+price+' MB)'}
				//var players = [];
				//for (var j = 0; j < data.ownhistory[i].slots.length; j++) {
				//	if (j === (win - 1)) {
				//		players.push(data.ownhistory[i].slots[j].name + ' (<i class="icon style6 fa-star"></i>)');
				//	} else {
				//		players.push(data.ownhistory[i].slots[j].name);
				//	}
				//}
				tableBody.innerHTML += "<tr><td>" + gamename + "</td><td>" + myslots + "</td><td><a href='./proof.html?proofid=" + proof + "'>" + proof.slice(0, 6) + '...' + "</a></td></tr>"
			}
		}
	}

	function getgames() {
		if (account != '')
		{
			var getstring = './account/games?account=' + account;

		} else { var getstring = './account/games'; }

		superagent.get(getstring, function (err, res) {
			if (err) {
				console.log(err)
				return
			}
			var data = JSON.parse(res.text);
			gametable(data);
			if (data.last_msg) {
				if (last_msg != data.last_msg){
					last_msg = data.last_msg;
					notifyMe(last_msg);
				}
			}
		})
	}



	function joingame(type) {

		document.getElementById("bjoin" + type).disabled = true;
		document.getElementById("bjoin" + type).textContent = 'joining...';

		superagent.get('./account/join?account=' + account+'&type='+type, function (err, res) {
			if (err) {
				notifyMe(err);
			} else {
				notifyMe(res.text);
				getaccount();
				getgames();
			}
			document.getElementById("bjoin" + type).disabled = false;
			document.getElementById("bjoin" + type).textContent = 'Join now!';
		})
	}

function getaccount() {
superagent.get('./account/get?account='+account, function (err, res) {
          if (err) {
            console.log(err)
            return
		  }
		  var data = JSON.parse(res.text);
		  if (data.name != 0) {
			  // found an valid account
			  document.getElementById("accountdata").style.display = "flex";
			  document.getElementById("settings").style.display = "block";
			  document.getElementById("noaccount").style.display = "none";
			  document.getElementById("username").textContent = data.name;
			  document.getElementById("tickets").textContent = String(data.tickets);
			  // Settings
			  document.getElementById("notifications").checked = data.settings.notifications;
			  document.getElementById("chatmessages").checked = data.settings.chat_messages;
			  document.getElementById("auto4").checked = data.settings.amount4;
			  document.getElementById("auto8").checked = data.settings.amount8;
			  document.getElementById("auto32").checked = data.settings.amount32;
		  } else {
			  // No valid account
		  }
        })
}

	function change_settings(element) {
		//if (element === 'notifications') {
		//	var value = Number(document.getElementById(element).checked);
		//	account_change(element, value);
		//} else if (element === 'chat_messages') {
		//	var value = Number(document.getElementById(element).checked);
		//	account_change(element, value);
		//} else if (element === 'auto4') {
		//	var value = Number(document.getElementById(element).checked);
		//	account_change(element, value);
		//} else if (element === 'auto8') {
		//	var value = Number(document.getElementById(element).checked);
		//	account_change(element, value);
		//} else if (element === 'auto32') {
		//	var value = Number(document.getElementById(element).checked);
		//	account_change(element, value);
		//}
		var value = Number(document.getElementById(element).checked);
		account_change(element, value);
	}

	function account_change(type,value) {
		superagent.get('./account/get?type='+type+'&value='+value+'&account=' + account, function (err, res) {
			if (err) {
				console.log(err)
				notifyMe('No luck :(');
				return
			}
			var data = JSON.parse(res.text);
			if (data.name != 0) {
				// found an valid account
				document.getElementById("accountdata").style.display = "flex";
				document.getElementById("noaccount").style.display = "none";
				document.getElementById("username").textContent = data.name;
				document.getElementById("tickets").textContent = String(data.tickets);
				// Settings
				document.getElementById("notifications").checked = data.settings.notifications;
				document.getElementById("chatmessages").checked = data.settings.chat_messages;
				document.getElementById("auto4").checked = data.settings.amount4;
				document.getElementById("auto8").checked = data.settings.amount8;
				document.getElementById("auto32").checked = data.settings.amount32;
			} else {
				notifyMe('No luck :(');
			}
		})
	}

function notifyMe(text, delay=3000) {
	  $("#notification").fadeIn("fast").html(text);
	  setTimeout(function () {
		$("#notification").fadeOut("slow");
	  },delay);
}

function getParams(name, url) {
  if (!url) url = window.location.href;
  name = name.replace(/[\[\]]/g, "\\$&");
  var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)")
  var results = regex.exec(url);
  if (!results) return null;
  if (!results[2]) return '';
  return decodeURIComponent(results[2].replace(/\+/g, " "));
}
</script>

	</body>
</html>